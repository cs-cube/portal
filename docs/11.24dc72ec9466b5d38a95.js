(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ImkO:function(t,i,e){"use strict";e.r(i);var n=e("Valr"),a=e("ea4N"),c=e("cPJV"),s=e("ETwC"),r=e("mrSG"),o=e("gSfl"),l=function(t){function i(){var i=t.call(this)||this;return i.sales=0,i}return Object(r.b)(i,t),i.prototype.computeSales=function(){var t=this;this.transaction_items&&(this.sales=0,this.transaction_items.forEach((function(i){t.sales+=i.total})))},i}(o.a),b=function(t){function i(){var i=t.call(this)||this;return i.reset(),i}return Object(r.b)(i,t),i.prototype.markAsValid=function(){this._valid=!0},Object.defineProperty(i.prototype,"valid",{get:function(){return this._valid},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"is_ready",{get:function(){return 1==this.type&&null!=this.paper_size_id&&null!=this.print_quality_id||2==this.type},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this._valid=!1,this.type=1,this.paper_size_id=null,this.print_quality_id=null,this.quantity=1,this.price=0,this.total=0},Object.defineProperty(i.prototype,"is_printing",{get:function(){return 1==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"is_scanning",{get:function(){return 2==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type_label",{get:function(){return 1==this.type?"Print":"Scan"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"computed_total",{get:function(){return this.quantity*this.price},enumerable:!0,configurable:!0}),i}(o.a),u=e("TYT/"),d=e("WHFS"),p=e("fB3y"),f=e("cUzu"),m=function(t){function i(i){return t.call(this,i,"service-transactions")||this}return Object(r.b)(i,t),i.\u0275fac=function(t){return new(t||i)(u.fc(f.b))},i.\u0275prov=u.Nb({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(p.a),h=e("eHTH"),v=e("agxM"),g=e("QJY3"),_=e("cSbt"),y=e("p+mS"),D=e("GsDI"),S=e("MqYC"),W=["cancelButton"];function X(t,i){if(1&t&&(u.Xb(0,"mat-option",34),u.Lc(1),u.Wb()),2&t){var e=i.$implicit;u.tc("value",e.id),u.Db(1),u.Nc(" ",e.fullname," ")}}function w(t,i){1&t&&(u.Xb(0,"th",35),u.Lc(1," Type "),u.Wb())}function I(t,i){if(1&t&&(u.Xb(0,"span"),u.Lc(1),u.Wb()),2&t){var e=u.nc().$implicit;u.Db(1),u.Mc(e.type_label)}}function L(t,i){if(1&t&&(u.Xb(0,"mat-option",34),u.Lc(1),u.Wb()),2&t){var e=i.$implicit;u.tc("value",e.key),u.Db(1),u.Mc(e.value)}}function T(t,i){if(1&t){var e=u.Yb();u.Xb(0,"mat-form-field"),u.Xb(1,"mat-select",38),u.jc("ngModelChange",(function(t){return u.Cc(e),u.nc().$implicit.type=t}))("selectionChange",(function(t){u.Cc(e);var i=u.nc().$implicit;return u.nc().setPrice(i)})),u.Jc(2,L,2,2,"mat-option",7),u.Wb(),u.Wb()}if(2&t){var n=u.nc().$implicit,a=u.nc();u.Db(1),u.tc("ngModel",n.type),u.Db(1),u.tc("ngForOf",a.station.service_types)}}function C(t,i){if(1&t&&(u.Xb(0,"td",36),u.Jc(1,I,2,1,"span",37),u.Jc(2,T,3,2,"mat-form-field",37),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.tc("ngIf",e.valid),u.Db(1),u.tc("ngIf",!e.valid)}}function J(t,i){1&t&&(u.Xb(0,"th",35),u.Lc(1," Size "),u.Wb())}function q(t,i){if(1&t&&(u.Xb(0,"span"),u.Lc(1),u.Wb()),2&t){var e=u.nc().$implicit;u.Db(1),u.Mc(e.is_scanning?"N/A":e.paper_size.description)}}function M(t,i){if(1&t&&(u.Xb(0,"mat-option",34),u.Lc(1),u.Wb()),2&t){var e=i.$implicit;u.tc("value",e.id),u.Db(1),u.Mc(e.description)}}function R(t,i){if(1&t){var e=u.Yb();u.Xb(0,"mat-form-field"),u.Xb(1,"mat-select",39),u.jc("ngModelChange",(function(t){return u.Cc(e),u.nc().$implicit.paper_size_id=t}))("selectionChange",(function(t){u.Cc(e);var i=u.nc().$implicit;return u.nc().setPrice(i)})),u.Jc(2,M,2,2,"mat-option",7),u.Wb(),u.Wb()}if(2&t){var n=u.nc().$implicit,a=u.nc();u.Db(1),u.tc("disabled",n.is_scanning)("ngModel",n.paper_size_id),u.Db(1),u.tc("ngForOf",a.paper_sizes)}}function k(t,i){if(1&t&&(u.Xb(0,"td",36),u.Jc(1,q,2,1,"span",37),u.Jc(2,R,3,3,"mat-form-field",37),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.tc("ngIf",e.valid),u.Db(1),u.tc("ngIf",!e.valid)}}function z(t,i){1&t&&(u.Xb(0,"th",35),u.Lc(1," Quality "),u.Wb())}function $(t,i){if(1&t&&(u.Xb(0,"span"),u.Lc(1),u.Wb()),2&t){var e=u.nc().$implicit;u.Db(1),u.Mc(e.is_scanning?"N/A":e.print_quality.description)}}function O(t,i){if(1&t&&(u.Xb(0,"mat-option",34),u.Lc(1),u.Wb()),2&t){var e=i.$implicit;u.tc("value",e.id),u.Db(1),u.Mc(e.description)}}function j(t,i){if(1&t){var e=u.Yb();u.Xb(0,"mat-form-field"),u.Xb(1,"mat-select",41),u.jc("ngModelChange",(function(t){return u.Cc(e),u.nc().$implicit.print_quality_id=t}))("selectionChange",(function(t){u.Cc(e);var i=u.nc().$implicit;return u.nc().setPrice(i)})),u.Jc(2,O,2,2,"mat-option",7),u.Wb(),u.Wb()}if(2&t){var n=u.nc().$implicit,a=u.nc();u.Db(1),u.tc("disabled",n.is_scanning)("ngModel",n.print_quality_id),u.Db(1),u.tc("ngForOf",a.print_qualities)}}function N(t,i){if(1&t&&(u.Xb(0,"td",40),u.Jc(1,$,2,1,"span",37),u.Jc(2,j,3,3,"mat-form-field",37),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.tc("ngIf",e.valid),u.Db(1),u.tc("ngIf",!e.valid)}}function Y(t,i){1&t&&(u.Xb(0,"th",35),u.Lc(1," Quantity "),u.Wb())}function P(t,i){if(1&t){var e=u.Yb();u.Xb(0,"mat-form-field"),u.Xb(1,"input",43),u.jc("ngModelChange",(function(t){return u.Cc(e),u.nc().$implicit.quantity=t})),u.Wb(),u.Wb()}if(2&t){var n=u.nc().$implicit;u.Db(1),u.tc("ngModel",n.quantity)}}function x(t,i){if(1&t&&(u.Xb(0,"td",42),u.Jc(1,P,2,1,"mat-form-field",37),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.tc("ngIf",e.is_ready)}}function V(t,i){1&t&&(u.Xb(0,"th",44),u.Lc(1," Price "),u.Wb())}function U(t,i){if(1&t&&(u.Xb(0,"span"),u.Lc(1),u.Wb()),2&t){var e=u.nc().$implicit;u.Db(1),u.Mc(e.price)}}function A(t,i){if(1&t&&(u.Xb(0,"td",42),u.Jc(1,U,2,1,"span",37),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.tc("ngIf",e.is_ready)}}function F(t,i){1&t&&(u.Xb(0,"th",45),u.Lc(1," Amount "),u.Wb())}function H(t,i){if(1&t&&(u.Xb(0,"span"),u.Lc(1),u.Wb()),2&t){var e=u.nc().$implicit;u.Db(1),u.Mc(e.computed_total)}}function Q(t,i){if(1&t&&(u.Xb(0,"td",42),u.Jc(1,H,2,1,"span",37),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.tc("ngIf",e.is_ready)}}function E(t,i){1&t&&u.Sb(0,"th",46)}function B(t,i){1&t&&(u.Xb(0,"mat-icon"),u.Lc(1,"remove"),u.Wb())}function G(t,i){1&t&&(u.Xb(0,"mat-icon"),u.Lc(1,"refresh"),u.Wb())}function K(t,i){if(1&t){var e=u.Yb();u.Xb(0,"button",49),u.jc("click",(function(t){u.Cc(e);var i=u.nc().$implicit;return u.nc().removeItem(i)})),u.Jc(1,B,2,0,"mat-icon",37),u.Jc(2,G,2,0,"mat-icon",37),u.Wb()}if(2&t){var n=u.nc().$implicit,a=u.nc();u.tc("disabled",a.savingTransaction),u.Db(1),u.tc("ngIf",n.valid),u.Db(1),u.tc("ngIf",n.dirty&&a.transaction.transaction_items.length>1)}}function Z(t,i){if(1&t&&(u.Xb(0,"td",47),u.Jc(1,K,3,3,"button",48),u.Wb()),2&t){var e=i.$implicit,n=u.nc();u.Db(1),u.tc("ngIf",e.valid||n.transaction.transaction_items.length>1)}}function tt(t,i){1&t&&u.Sb(0,"tr",50)}function it(t,i){1&t&&u.Sb(0,"tr",51)}function et(t,i){if(1&t){var e=u.Yb();u.Xb(0,"button",32),u.jc("click",(function(t){return u.Cc(e),u.nc().addItem()})),u.Sb(1,"i",52),u.Wb()}if(2&t){var n=u.nc();u.tc("disabled",n.savingTransaction)}}var nt=function(){function t(t,i,e,n){this.dialogRef=t,this.modalService=i,this.serviceTransactionService=e,this.matData=n,this.members=[{id:"1",fullname:"Anonymous"}],this.transactionItemTableColumns=["type","size","quality","quantity","price","total","action"],this.savingTransaction=!1,this.service_rates=[],this.transaction=new l,this.transaction.member_id="1",this.transaction.timeFormatted=c(new Date,"MMM DD, YYYY hh:mm A"),this.currentTransactionItem=new b,this.transaction.transaction_items=[this.currentTransactionItem],this.mds=new s.k(this.transaction.transaction_items),this.station=this.matData.station,this.paper_sizes=this.matData.paper_sizes,this.print_qualities=this.matData.print_qualities,this.service_rates=this.matData.service_rates}return t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){},t.prototype.addItem=function(){this.currentTransactionItem.is_ready&&(this.checkDuplicates()||(this.currentTransactionItem.markAsValid(),this.currentTransactionItem=new b,this.transaction.transaction_items.push(this.currentTransactionItem)),this.mds.connect().next(this.transaction.transaction_items),this.transaction.computeSales())},t.prototype.checkDuplicates=function(){var t=this,i=!1;return this.transaction.transaction_items.forEach((function(e,n){!i&&t.currentTransactionItem.is_printing&&e.valid&&e.paper_size_id===t.currentTransactionItem.paper_size_id&&e.print_quality_id===t.currentTransactionItem.print_quality_id&&(i=!0,e.quantity+=t.currentTransactionItem.quantity,t.currentTransactionItem.reset()),!i&&t.currentTransactionItem.is_scanning&&e.is_scanning&&e.valid&&(i=!0,e.quantity+=t.currentTransactionItem.quantity,t.currentTransactionItem.reset())})),i},t.prototype.removeItem=function(t){t.valid&&(this.transaction.transaction_items=this.transaction.transaction_items.filter((function(i){return!(i.type==t.type&&i.paper_size_id==t.paper_size_id&&i.print_quality_id==t.print_quality_id&&i.valid)}))),this.mds.connect().next(this.transaction.transaction_items)},t.prototype.saveTransaction=function(){var t=this;this.modalService.confirm({message:"Save this transaction?"}).then((function(i){i&&(t.checkDuplicates(),t.currentTransactionItem.is_ready&&t.addItem(),t.transaction.transaction_items=t.transaction.transaction_items.filter((function(t){return t.valid})),t.transaction.station_id=t.station.id,t.savingTransaction=!0,t.serviceTransactionService.create(t.transaction).subscribe((function(i){t.modalService.toast("Transaction saved!"),t.dialogRef.close(i),t.savingTransaction=!1}),(function(i){t.modalService.swal({title:"Saving Transaction Failed",text:"Unknown Error Occured",icon:"error"}),t.savingTransaction=!1})))}))},t.prototype.setPrice=function(t){2==t.type?(t.paper_size_id=null,t.print_quality_id=null,console.log(this.service_rates.filter((function(t){return t.is_scanning}))),t.price=this.service_rates.filter((function(t){return t.is_scanning}))[0].rate):(t.paper_size_id&&(t.paper_size=this.paper_sizes.filter((function(i){return i.id==t.paper_size_id}))[0]),t.print_quality_id&&(t.print_quality=this.print_qualities.filter((function(i){return i.id==t.print_quality_id}))[0]),t.paper_size_id&&t.print_quality_id&&(t.price=this.service_rates.filter((function(i){return i.is_printing&&i.paper_size_id==t.paper_size_id&&i.print_quality_id==t.print_quality_id}))[0].rate))},t.\u0275fac=function(i){return new(i||t)(u.Rb(a.g),u.Rb(d.a),u.Rb(m),u.Rb(a.a))},t.\u0275cmp=u.Lb({type:t,selectors:[["app-create-transaction"]],viewQuery:function(t,i){var e;1&t&&u.Qc(W,!0),2&t&&u.Ac(e=u.kc())&&(i.cancelButton=e.first)},decls:57,vars:15,consts:[["mat-dialog-title",""],[1,"fa","fa-print"],[1,"mat-typography"],[1,"row"],[1,"col-lg-3"],[1,"full-width"],[3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","disabled","",3,"ngModel","ngModelChange"],[1,"p-1","bg-primary"],[1,"col-lg-12"],[1,"table-responsive"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","type"],["mat-header-cell","","style","width: 20%;",4,"matHeaderCellDef"],["mat-cell","","class","pr-3",4,"matCellDef"],["matColumnDef","size"],["matColumnDef","quality"],["mat-cell","","class","p-2",4,"matCellDef"],["matColumnDef","quantity"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","price"],["mat-header-cell","","style","width: 20%;","class","text-center",4,"matHeaderCellDef"],["matColumnDef","total",2,"width","10%"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["matColumnDef","action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["align","end"],["mat-raised-button","",3,"disabled","click",4,"ngIf"],["mat-raised-button","",3,"disabled","click"],["mat-button","","mat-dialog-close","",3,"disabled"],[3,"value"],["mat-header-cell","",2,"width","20%"],["mat-cell","",1,"pr-3"],[4,"ngIf"],["aria-placeholder","Size",3,"ngModel","ngModelChange","selectionChange"],["aria-placeholder","Size",3,"disabled","ngModel","ngModelChange","selectionChange"],["mat-cell","",1,"p-2"],["aria-placeholder","Quality",3,"disabled","ngModel","ngModelChange","selectionChange"],["mat-cell","",1,"text-center"],["matInput","","type","number","autocomplete","off","min","1",1,"text-center",3,"ngModel","ngModelChange"],["mat-header-cell","",1,"text-center",2,"width","20%"],["mat-header-cell","",1,"text-center"],["mat-header-cell",""],["mat-cell",""],["mat-raised-button","","color","error",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","error",3,"disabled","click"],["mat-header-row",""],["mat-row",""],[1,"fa","fa-plus"]],template:function(t,i){1&t&&(u.Xb(0,"h2",0),u.Sb(1,"i",1),u.Lc(2," New Print Transaction"),u.Wb(),u.Xb(3,"mat-dialog-content",2),u.Xb(4,"div",3),u.Xb(5,"div",4),u.Xb(6,"mat-form-field",5),u.Xb(7,"mat-label"),u.Lc(8,"Member"),u.Wb(),u.Xb(9,"mat-select",6),u.jc("ngModelChange",(function(t){return i.transaction.member_id=t})),u.Jc(10,X,2,2,"mat-option",7),u.Wb(),u.Wb(),u.Wb(),u.Xb(11,"div",4),u.Xb(12,"mat-form-field",5),u.Xb(13,"mat-label"),u.Lc(14,"Transacttion Time"),u.Wb(),u.Xb(15,"input",8),u.jc("ngModelChange",(function(t){return i.transaction.time=t})),u.Wb(),u.Wb(),u.Wb(),u.Xb(16,"div",4),u.Xb(17,"h2",9),u.Lc(18),u.oc(19,"currency"),u.Wb(),u.Wb(),u.Wb(),u.Xb(20,"div",3),u.Xb(21,"div",10),u.Xb(22,"div",11),u.Xb(23,"table",12),u.Vb(24,13),u.Jc(25,w,2,0,"th",14),u.Jc(26,C,3,2,"td",15),u.Ub(),u.Vb(27,16),u.Jc(28,J,2,0,"th",14),u.Jc(29,k,3,2,"td",15),u.Ub(),u.Vb(30,17),u.Jc(31,z,2,0,"th",14),u.Jc(32,N,3,2,"td",18),u.Ub(),u.Vb(33,19),u.Jc(34,Y,2,0,"th",14),u.Jc(35,x,2,1,"td",20),u.Ub(),u.Vb(36,21),u.Jc(37,V,2,0,"th",22),u.Jc(38,A,2,1,"td",20),u.Ub(),u.Vb(39,23),u.Jc(40,F,2,0,"th",24),u.Jc(41,Q,2,1,"td",20),u.Ub(),u.Vb(42,25),u.Jc(43,E,1,0,"th",26),u.Jc(44,Z,2,1,"td",27),u.Ub(),u.Jc(45,tt,1,0,"tr",28),u.Jc(46,it,1,0,"tr",29),u.Wb(),u.Wb(),u.Wb(),u.Wb(),u.Wb(),u.Xb(47,"mat-dialog-actions",30),u.Jc(48,et,2,1,"button",31),u.Xb(49,"button",32),u.jc("click",(function(t){return i.saveTransaction()})),u.Xb(50,"mat-icon"),u.Lc(51,"save"),u.Wb(),u.Lc(52),u.Wb(),u.Xb(53,"button",33),u.Xb(54,"mat-icon"),u.Lc(55,"remove"),u.Wb(),u.Lc(56," Cancel"),u.Wb(),u.Wb()),2&t&&(u.Db(9),u.tc("ngModel",i.transaction.member_id)("disabled",!0),u.Db(1),u.tc("ngForOf",i.members),u.Db(5),u.tc("ngModel",i.transaction.time),u.Db(3),u.Nc("Total: ",u.qc(19,12,i.transaction.sales," "),""),u.Db(5),u.tc("dataSource",i.mds),u.Db(22),u.tc("matHeaderRowDef",i.transactionItemTableColumns),u.Db(1),u.tc("matRowDefColumns",i.transactionItemTableColumns),u.Db(2),u.tc("ngIf",null==i.currentTransactionItem||i.currentTransactionItem.is_ready&&0==i.currentTransactionItem.valid),u.Db(1),u.tc("disabled",!i.currentTransactionItem.is_ready&&1==i.transaction.transaction_items.length||i.savingTransaction),u.Db(3),u.Nc(" ",i.savingTransaction?"Saving Transaction...":"Save Transaction"," "),u.Db(1),u.tc("disabled",i.savingTransaction))},directives:[a.h,a.e,h.b,h.e,v.a,g.k,g.n,n.l,_.a,g.b,s.j,s.c,s.e,s.b,s.g,s.i,a.c,n.m,y.b,D.a,a.d,S.h,s.d,s.a,g.p,s.f,s.h],pipes:[n.d],styles:[""]}),t}(),at=e("SWMs"),ct=e("kHN2"),st=e("DUip"),rt=function(t){function i(i){var e=t.call(this,i,"stations")||this;return e.http=i,e}return Object(r.b)(i,t),i.prototype.use=function(t,i){return this.http.put(this.uri+"/"+t.id,{use:1,password:i})},i.prototype.leave=function(t,i){return this.http.put(this.uri+"/"+t.id,{leave:1,password:i})},i.\u0275fac=function(t){return new(t||i)(u.fc(f.b))},i.\u0275prov=u.Nb({token:i,factory:i.\u0275fac,providedIn:"root"}),i}(p.a),ot=e("l5Kb"),lt=e("iPKQ"),bt=e("0gkb"),ut=e("o9IV"),dt=e("chSY"),pt=e("6onV"),ft=e("17Os"),mt=e("eJds"),ht=e("H6It"),vt=e("/RhQ");function gt(t,i){if(1&t){var e=u.Yb();u.Xb(0,"button",8),u.jc("click",(function(t){return u.Cc(e),u.nc(2).newTransaction()})),u.Lc(1,"New Transaction "),u.Wb()}if(2&t){var n=u.nc(2);u.tc("disabled",!n.paper_sizes||!n.print_qualities||!n.service_rates)}}function _t(t,i){1&t&&(u.Xb(0,"th",18),u.Lc(1,"Time"),u.Wb())}function yt(t,i){if(1&t&&(u.Xb(0,"td",19),u.Lc(1),u.oc(2,"dfnsFormat"),u.oc(3,"parseDate"),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.Nc(" ",u.qc(2,1,u.pc(3,4,e.time),"hh:mm A MMM DD, YYYY")," ")}}function Dt(t,i){1&t&&(u.Xb(0,"th",18),u.Lc(1,"Member"),u.Wb())}function St(t,i){if(1&t&&(u.Xb(0,"td",19),u.Lc(1),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.Nc(" ",e.member.fullname," ")}}function Wt(t,i){1&t&&(u.Xb(0,"th",18),u.Lc(1,"Sales"),u.Wb())}function Xt(t,i){if(1&t&&(u.Xb(0,"td",20),u.Lc(1),u.oc(2,"currency"),u.Wb()),2&t){var e=i.$implicit;u.Db(1),u.Nc(" ",u.qc(2,1,e.sales," ")," ")}}function wt(t,i){1&t&&u.Sb(0,"tr",21)}function It(t,i){1&t&&u.Sb(0,"tr",22)}function Lt(t,i){if(1&t&&(u.Xb(0,"table",9),u.Vb(1,10),u.Jc(2,_t,2,0,"th",11),u.Jc(3,yt,4,6,"td",12),u.Ub(),u.Vb(4,13),u.Jc(5,Dt,2,0,"th",11),u.Jc(6,St,2,1,"td",12),u.Ub(),u.Vb(7,14),u.Jc(8,Wt,2,0,"th",11),u.Jc(9,Xt,3,4,"td",15),u.Ub(),u.Jc(10,wt,1,0,"tr",16),u.Jc(11,It,1,0,"tr",17),u.Wb()),2&t){var e=u.nc(2);u.tc("dataSource",e.mds),u.Db(10),u.tc("matHeaderRowDef",e.transactionTableColumns),u.Db(1),u.tc("matRowDefColumns",e.transactionTableColumns)}}function Tt(t,i){1&t&&u.Sb(0,"app-ellipis-loading")}function Ct(t,i){if(1&t&&(u.Xb(0,"span"),u.Lc(1),u.Sb(2,"br"),u.Wb()),2&t){var e=u.nc(2);u.Db(1),u.Nc("Current user is ",e.station.current_session.user.fullname," ")}}function Jt(t,i){if(1&t&&(u.Xb(0,"h1"),u.Lc(1),u.oc(2,"currency"),u.Xb(3,"small"),u.Lc(4,"Total Sales"),u.Wb(),u.Wb()),2&t){var e=u.nc(2);u.Db(1),u.Nc("",u.qc(2,1,e.sales," ")," ")}}function qt(t,i){if(1&t){var e=u.Yb();u.Xb(0,"button",23),u.jc("click",(function(t){return u.Cc(e),u.nc(2).leaveSession()})),u.Xb(1,"mat-icon"),u.Lc(2,"exit_to_app"),u.Wb(),u.Lc(3),u.Wb()}if(2&t){var n=u.nc(2);u.tc("disabled",n.isLeaving),u.Db(3),u.Nc(" ",n.isLeaving?"Leaving Session...":"Leave Session","")}}function Mt(t,i){if(1&t&&(u.Xb(0,"div"),u.Xb(1,"div",1),u.Xb(2,"div",2),u.Xb(3,"mat-card"),u.Xb(4,"mat-card-header"),u.Xb(5,"mat-card-title"),u.Lc(6),u.Wb(),u.Xb(7,"mat-card-subtitle"),u.Sb(8,"br"),u.Jc(9,gt,2,1,"button",3),u.Wb(),u.Wb(),u.Xb(10,"mat-card-content"),u.Xb(11,"div",4),u.Jc(12,Lt,12,3,"table",5),u.Wb(),u.Jc(13,Tt,1,0,"app-ellipis-loading",0),u.Wb(),u.Wb(),u.Wb(),u.Xb(14,"div",6),u.Xb(15,"mat-card"),u.Xb(16,"mat-card-header"),u.Xb(17,"mat-card-title"),u.Lc(18,"Session Summary"),u.Wb(),u.Wb(),u.Xb(19,"mat-card-content"),u.Jc(20,Ct,3,1,"span",0),u.Lc(21),u.oc(22,"dfnsDistanceInWordsToNow"),u.oc(23,"parseDate"),u.Sb(24,"br"),u.Sb(25,"br"),u.Jc(26,Jt,5,4,"h1",0),u.Sb(27,"br"),u.Sb(28,"br"),u.Jc(29,qt,4,2,"button",7),u.Wb(),u.Wb(),u.Wb(),u.Wb(),u.Wb()),2&t){var e=u.nc();u.Db(6),u.Nc("Transactions on ",e.station.description," "),u.Db(3),u.tc("ngIf",e.isOnDuty),u.Db(3),u.tc("ngIf",0==e.isLoadingTransactions||e.mds.data),u.Db(1),u.tc("ngIf",e.isLoadingTransactions),u.Db(7),u.tc("ngIf",0==e.isOnDuty),u.Db(1),u.Nc(" Started ",u.pc(22,8,u.pc(23,10,e.station.current_session.time_in))," ago "),u.Db(5),u.tc("ngIf",!e.isLoadingTransactions),u.Db(3),u.tc("ngIf",e.isOnDuty)}}function Rt(t,i){1&t&&u.Sb(0,"app-ellipis-loading")}var kt=function(){function t(t,i,e,n,a,c,r,o,l,b,u,d){var p=this;this.activatedRoute=t,this.stationService=i,this.modalService=e,this.stateService=n,this.router=a,this.authService=c,this.paperSizeService=r,this.printQualityService=o,this.serviceRateService=l,this.serviceTransacrionService=b,this.dialog=u,this.store=d,this.station=null,this.isLeaving=!1,this.isOnDuty=!1,this.paper_sizes=[],this.print_qualities=[],this.service_rates=[],this.transactionTableColumns=["time","member","sales"],this.sales=0,this.isLoadingTransactions=!0,this.transactions=[],this.mds=new s.k,this.store.select("service_transactions").subscribe((function(t){p.transactions=t,p.mds.connect().next(p.transactions),p.sales=0,p.transactions&&p.transactions.forEach((function(t){p.sales+=Number(t.sales)}))}))}return t.prototype.ngOnInit=function(){var t=this;this.station=this.stateService.get("active_station"),null==this.station?this.stationService.read(this.activatedRoute.snapshot.params.station).subscribe((function(i){i.current_session?(t.station=i,t.isOnDuty=t.authService.user.id==t.station.current_session.user_id,t.isOnDuty&&t.stateService.set("active_station",i),t.fetchTransactions()):t.router.navigate(["management/service-transactions"])}),(function(i){t.modalService.toast("Error reading station"),t.router.navigate(["management/service-transactions"])})):(this.isOnDuty=this.authService.user.id==this.station.current_session.user_id,this.fetchTransactions()),this.fetchConfig()},t.prototype.fetchConfig=function(){var t=this;this.paper_sizes=this.stateService.get("paper_sizes"),this.print_qualities=this.stateService.get("print_qualities"),this.service_rates=this.stateService.get("service_rates"),null==this.paper_sizes&&this.paperSizeService.query().subscribe((function(i){t.paper_sizes=i,t.stateService.set("paper_sizes",i)})),null==this.print_qualities&&this.printQualityService.query().subscribe((function(i){t.print_qualities=i,t.stateService.set("print_qualities",i)})),null==this.service_rates&&this.serviceRateService.query().subscribe((function(i){t.service_rates=i.map((function(t){return(new at.a).fill(t)})),t.stateService.set("service_rates",t.service_rates)}))},t.prototype.leaveSession=function(){var t=this;this.modalService.prompt({question:"Please enter your password to continue",required:!0,password:!0}).then((function(i){i&&(t.isLeaving=!0,t.stationService.leave(t.station,i).subscribe((function(i){t.stateService.set("active_station",null),t.modalService.toast("You leaved the session","Session leaved"),t.router.navigate(["management/service-transactions"]),t.isLeaving=!1}),(function(i){"Password is incorrect"==i.error.message?t.modalService.swal({text:"Incorrect password",title:"Oops!",icon:"error"}):t.modalService.toast("Something went wrong","Oops!","error"),t.isLeaving=!1})))}))},t.prototype.newTransaction=function(){var t=this;this.dialog.open(nt,{width:"90%",disableClose:!0,data:{station:this.station,paper_sizes:this.paper_sizes,print_qualities:this.print_qualities,service_rates:this.service_rates}}).afterClosed().subscribe((function(i){i&&t.store.dispatch(new ct.b(i))}))},t.prototype.fetchTransactions=function(){var t=this;this.isLoadingTransactions=!0,this.serviceTransacrionService.query({params:{time:this.station.current_session.time_in,station_id:this.station.id}}).subscribe((function(i){t.isLoadingTransactions=!1,t.store.dispatch(new ct.c(i))}))},t.\u0275fac=function(i){return new(i||t)(u.Rb(st.a),u.Rb(rt),u.Rb(d.a),u.Rb(ot.a),u.Rb(st.g),u.Rb(lt.a),u.Rb(bt.a),u.Rb(ut.a),u.Rb(dt.a),u.Rb(m),u.Rb(a.b),u.Rb(pt.a))},t.\u0275cmp=u.Lb({type:t,selectors:[["app-show"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"row"],[1,"col-lg-8"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngIf"],[1,"table-responsive"],["mat-table","","class","full-width",3,"dataSource",4,"ngIf"],[1,"col-lg-4"],["mat-raised-button","","color","warn",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",3,"disabled","click"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","member"],["matColumnDef","sales"],["mat-cell","","class","text-right pr-2",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"text-right","pr-2"],["mat-header-row",""],["mat-row",""],["mat-raised-button","","color","warn",3,"disabled","click"]],template:function(t,i){1&t&&(u.Jc(0,Mt,30,12,"div",0),u.Jc(1,Rt,1,0,"app-ellipis-loading",0)),2&t&&(u.tc("ngIf",i.station&&null!=i.station.current_session),u.Db(1),u.tc("ngIf",null==i.station))},directives:[n.m,ft.a,ft.d,ft.g,ft.f,ft.c,y.b,s.j,s.c,s.e,s.b,s.g,s.i,s.d,s.a,s.f,s.h,mt.a,D.a],pipes:[ht.c,vt.a,ht.d,n.d],styles:[""]}),t}(),zt=e("p1Ls");function $t(t,i){if(1&t&&(u.Xb(0,"div"),u.Lc(1," Logged User: "),u.Xb(2,"span",7),u.Lc(3),u.Wb(),u.Sb(4,"br"),u.Sb(5,"br"),u.Xb(6,"a",8),u.Lc(7,"View Transactions"),u.Wb(),u.Wb()),2&t){var e=u.nc().$implicit;u.Db(3),u.Mc(e.current_session.user.fullname),u.Db(3),u.tc("routerLink","/service-transactions/"+e.id)}}function Ot(t,i){if(1&t&&(u.Xb(0,"span"),u.Lc(1),u.oc(2,"dfnsDistanceInWordsToNow"),u.oc(3,"parseDate"),u.Wb()),2&t){var e=u.nc(2).$implicit;u.Db(1),u.Oc(" Last used by ",e.previous_session.user.firstname," ",u.pc(2,2,u.pc(3,4,e.previous_session.time_out))," ago ")}}function jt(t,i){1&t&&(u.Xb(0,"span"),u.Lc(1," No previous user "),u.Wb())}function Nt(t,i){if(1&t){var e=u.Yb();u.Xb(0,"div",9),u.Jc(1,Ot,4,6,"span",0),u.Jc(2,jt,2,0,"span",0),u.Sb(3,"br"),u.Sb(4,"br"),u.Xb(5,"button",10),u.jc("click",(function(t){u.Cc(e);var i=u.nc().$implicit;return u.nc(2).useStation(i)})),u.Lc(6),u.Wb(),u.Wb()}if(2&t){var n=u.nc().$implicit;u.Db(1),u.tc("ngIf",n.previous_session),u.Db(1),u.tc("ngIf",null==n.previous_session),u.Db(3),u.tc("disabled",n.isJoining||0==n.allowed_to_use),u.Db(1),u.Mc(n.isJoining?"Loading...":"Use")}}function Yt(t,i){if(1&t&&(u.Xb(0,"div",4),u.Xb(1,"mat-card",5),u.Xb(2,"mat-card-header"),u.Xb(3,"mat-card-title-group"),u.Xb(4,"mat-card-title"),u.Xb(5,"mat-icon"),u.Lc(6,"desktop_windows"),u.Wb(),u.Lc(7),u.Wb(),u.Wb(),u.Wb(),u.Xb(8,"mat-card-content"),u.Jc(9,$t,8,2,"div",0),u.Jc(10,Nt,7,4,"div",6),u.Wb(),u.Wb(),u.Wb()),2&t){var e=i.$implicit;u.Db(7),u.Nc(" ",e.description," "),u.Db(2),u.tc("ngIf",e.current_session),u.Db(1),u.tc("ngIf",null==e.current_session)}}function Pt(t,i){1&t&&(u.Xb(0,"div",4),u.Xb(1,"mat-card"),u.Xb(2,"mat-card-content"),u.Sb(3,"app-ellipis-loading"),u.Wb(),u.Wb(),u.Wb())}function xt(t,i){if(1&t&&(u.Xb(0,"div"),u.Xb(1,"h1"),u.Lc(2,"Choose Station"),u.Wb(),u.Xb(3,"div",1),u.Jc(4,Yt,11,3,"div",2),u.Jc(5,Pt,4,0,"div",3),u.Wb(),u.Wb()),2&t){var e=u.nc();u.Db(4),u.tc("ngForOf",e.stations),u.Db(1),u.tc("ngIf",e.fetchingStations)}}var Vt=[{path:"",component:function(){function t(t,i,e,n,a,c){var s=this;this.stationService=t,this.authService=i,this.router=e,this.stateService=n,this.modalService=a,this.store=c,this.fetchingStations=!1,this.store.select("stations").subscribe((function(t){s.stations=t}))}return t.prototype.ngOnInit=function(){var t=this.stateService.get("active_station");t?this.setActiveStation(t):this.fetchStations()},t.prototype.fetchStations=function(){var t=this;this.fetchingStations=!0,this.stationService.query().subscribe((function(i){var e=null;i.forEach((function(i){i.current_session&&i.current_session.user_id==t.authService.user.id&&(e=i)})),null==e?t.store.dispatch(new zt.b(i)):t.setActiveStation(e),t.fetchingStations=!1}))},t.prototype.useStation=function(t){var i=this;t=Object(r.a)({},t),this.modalService.prompt({question:"Please enter your password to continue",required:!0,password:!0}).then((function(e){e&&(t.isJoining=!0,i.stationService.use(t,e).subscribe((function(t){t.isJoining=!1,i.setActiveStation(t)}),(function(e){t.isJoining=!1,i.modalService.alert({message:"Password is not correct",type:"warn"})})))}))},t.prototype.setActiveStation=function(t){this.stateService.set("active_station",t),this.router.navigate(["management/service-transactions/"+t.id])},t.\u0275fac=function(i){return new(i||t)(u.Rb(rt),u.Rb(lt.a),u.Rb(st.g),u.Rb(ot.a),u.Rb(d.a),u.Rb(pt.a))},t.\u0275cmp=u.Lb({type:t,selectors:[["app-index"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"row"],["class","col-lg-3",4,"ngFor","ngForOf"],["class","col-lg-3",4,"ngIf"],[1,"col-lg-3"],[1,"h-100"],["class","text-muted",4,"ngIf"],[1,"text-primary"],["mat-raised-button","","color","primary",3,"routerLink"],[1,"text-muted"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(t,i){1&t&&u.Jc(0,xt,6,2,"div",0),2&t&&u.tc("ngIf",i.stations)},directives:[n.m,n.l,ft.a,ft.d,ft.h,ft.g,D.a,ft.c,y.a,st.j,y.b,mt.a],pipes:[ht.c,vt.a],styles:[""]}),t}()},{path:":station",component:kt}],Ut=function(){function t(){}return t.\u0275mod=u.Pb({type:t}),t.\u0275inj=u.Ob({factory:function(i){return new(i||t)},imports:[[st.k.forChild(Vt)],st.k]}),t}(),At=e("FpXt");e.d(i,"ServiceTransactionsModule",(function(){return Ft}));var Ft=function(){function t(){}return t.\u0275mod=u.Pb({type:t}),t.\u0275inj=u.Ob({factory:function(i){return new(i||t)},imports:[[n.c,Ut,At.a]]}),t}()}}]);